{"remainingRequest":"G:\\学习\\前端\\vue3\\admin_chn\\vue-element-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\学习\\前端\\vue3\\admin_chn\\vue-element-admin\\src\\components\\HeaderSearch\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"G:\\学习\\前端\\vue3\\admin_chn\\vue-element-admin\\src\\components\\HeaderSearch\\index.vue","mtime":1686317623523},{"path":"G:\\学习\\前端\\vue3\\admin_chn\\vue-element-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686317881344},{"path":"G:\\学习\\前端\\vue3\\admin_chn\\vue-element-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1686317882159},{"path":"G:\\学习\\前端\\vue3\\admin_chn\\vue-element-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686317881344},{"path":"G:\\学习\\前端\\vue3\\admin_chn\\vue-element-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1686317877158}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQovLyBmdXNlIGlzIGEgbGlnaHR3ZWlnaHQgZnV6enktc2VhcmNoIG1vZHVsZQ0KLy8gbWFrZSBzZWFyY2ggcmVzdWx0cyBtb3JlIGluIGxpbmUgd2l0aCBleHBlY3RhdGlvbnMNCmltcG9ydCBGdXNlIGZyb20gJ2Z1c2UuanMnDQppbXBvcnQgcGF0aCBmcm9tICdwYXRoJw0KaW1wb3J0IGkxOG4gZnJvbSAnQC9sYW5nJw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICdIZWFkZXJTZWFyY2gnLA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBzZWFyY2g6ICcnLA0KICAgICAgb3B0aW9uczogW10sDQogICAgICBzZWFyY2hQb29sOiBbXSwNCiAgICAgIHNob3c6IGZhbHNlLA0KICAgICAgZnVzZTogdW5kZWZpbmVkDQogICAgfQ0KICB9LA0KICBjb21wdXRlZDogew0KICAgIHJvdXRlcygpIHsNCiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5nZXR0ZXJzLnBlcm1pc3Npb25fcm91dGVzDQogICAgfSwNCiAgICBsYW5nKCkgew0KICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmdldHRlcnMubGFuZ3VhZ2UNCiAgICB9LA0KICAgIHN1cHBvcnRQaW55aW5TZWFyY2goKSB7DQogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUuc2V0dGluZ3Muc3VwcG9ydFBpbnlpblNlYXJjaA0KICAgIH0NCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICBsYW5nKCkgew0KICAgICAgdGhpcy5zZWFyY2hQb29sID0gdGhpcy5nZW5lcmF0ZVJvdXRlcyh0aGlzLnJvdXRlcykNCiAgICB9LA0KICAgIHJvdXRlcygpIHsNCiAgICAgIHRoaXMuc2VhcmNoUG9vbCA9IHRoaXMuZ2VuZXJhdGVSb3V0ZXModGhpcy5yb3V0ZXMpDQogICAgfSwNCiAgICBzZWFyY2hQb29sKGxpc3QpIHsNCiAgICAgIC8vIFN1cHBvcnQgcGlueWluIHNlYXJjaA0KICAgICAgaWYgKHRoaXMubGFuZyA9PT0gJ3poJyAmJiB0aGlzLnN1cHBvcnRQaW55aW5TZWFyY2gpIHsNCiAgICAgICAgdGhpcy5hZGRQaW55aW5GaWVsZChsaXN0KQ0KICAgICAgfQ0KICAgICAgdGhpcy5pbml0RnVzZShsaXN0KQ0KICAgIH0sDQogICAgc2hvdyh2YWx1ZSkgew0KICAgICAgaWYgKHZhbHVlKSB7DQogICAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNsb3NlKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY2xvc2UpDQogICAgICB9DQogICAgfQ0KICB9LA0KICBtb3VudGVkKCkgew0KICAgIHRoaXMuc2VhcmNoUG9vbCA9IHRoaXMuZ2VuZXJhdGVSb3V0ZXModGhpcy5yb3V0ZXMpDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBhc3luYyBhZGRQaW55aW5GaWVsZChsaXN0KSB7DQogICAgICBjb25zdCB7IGRlZmF1bHQ6IHBpbnlpbiB9ID0gYXdhaXQgaW1wb3J0KCdwaW55aW4nKQ0KICAgICAgaWYgKEFycmF5LmlzQXJyYXkobGlzdCkpIHsNCiAgICAgICAgbGlzdC5mb3JFYWNoKGVsZW1lbnQgPT4gew0KICAgICAgICAgIGNvbnN0IHRpdGxlID0gZWxlbWVudC50aXRsZQ0KICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHRpdGxlKSkgew0KICAgICAgICAgICAgdGl0bGUuZm9yRWFjaCh2ID0+IHsNCiAgICAgICAgICAgICAgdiA9IHBpbnlpbih2LCB7DQogICAgICAgICAgICAgICAgc3R5bGU6IHBpbnlpbi5TVFlMRV9OT1JNQUwNCiAgICAgICAgICAgICAgfSkuam9pbignJykNCiAgICAgICAgICAgICAgZWxlbWVudC5waW55aW5UaXRsZSA9IHYNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICByZXR1cm4gbGlzdA0KICAgICAgfQ0KICAgIH0sDQogICAgY2xpY2soKSB7DQogICAgICB0aGlzLnNob3cgPSAhdGhpcy5zaG93DQogICAgICBpZiAodGhpcy5zaG93KSB7DQogICAgICAgIHRoaXMuJHJlZnMuaGVhZGVyU2VhcmNoU2VsZWN0ICYmIHRoaXMuJHJlZnMuaGVhZGVyU2VhcmNoU2VsZWN0LmZvY3VzKCkNCiAgICAgIH0NCiAgICB9LA0KICAgIGNsb3NlKCkgew0KICAgICAgdGhpcy4kcmVmcy5oZWFkZXJTZWFyY2hTZWxlY3QgJiYgdGhpcy4kcmVmcy5oZWFkZXJTZWFyY2hTZWxlY3QuYmx1cigpDQogICAgICB0aGlzLm9wdGlvbnMgPSBbXQ0KICAgICAgdGhpcy5zaG93ID0gZmFsc2UNCiAgICB9LA0KICAgIGNoYW5nZSh2YWwpIHsNCiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHZhbC5wYXRoKQ0KICAgICAgdGhpcy5zZWFyY2ggPSAnJw0KICAgICAgdGhpcy5vcHRpb25zID0gW10NCiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgdGhpcy5zaG93ID0gZmFsc2UNCiAgICAgIH0pDQogICAgfSwNCiAgICBpbml0RnVzZShsaXN0KSB7DQogICAgICB0aGlzLmZ1c2UgPSBuZXcgRnVzZShsaXN0LCB7DQogICAgICAgIHNob3VsZFNvcnQ6IHRydWUsDQogICAgICAgIHRocmVzaG9sZDogMC40LA0KICAgICAgICBsb2NhdGlvbjogMCwNCiAgICAgICAgZGlzdGFuY2U6IDEwMCwNCiAgICAgICAgbWF4UGF0dGVybkxlbmd0aDogMzIsDQogICAgICAgIG1pbk1hdGNoQ2hhckxlbmd0aDogMSwNCiAgICAgICAga2V5czogW3sNCiAgICAgICAgICBuYW1lOiAndGl0bGUnLA0KICAgICAgICAgIHdlaWdodDogMC43DQogICAgICAgIH0sIHsNCiAgICAgICAgICBuYW1lOiAncGlueWluVGl0bGUnLA0KICAgICAgICAgIHdlaWdodDogMC4zDQogICAgICAgIH0sIHsNCiAgICAgICAgICBuYW1lOiAncGF0aCcsDQogICAgICAgICAgd2VpZ2h0OiAwLjMNCiAgICAgICAgfV0NCiAgICAgIH0pDQogICAgfSwNCiAgICAvLyBGaWx0ZXIgb3V0IHRoZSByb3V0ZXMgdGhhdCBjYW4gYmUgZGlzcGxheWVkIGluIHRoZSBzaWRlYmFyDQogICAgLy8gQW5kIGdlbmVyYXRlIHRoZSBpbnRlcm5hdGlvbmFsaXplZCB0aXRsZQ0KICAgIGdlbmVyYXRlUm91dGVzKHJvdXRlcywgYmFzZVBhdGggPSAnLycsIHByZWZpeFRpdGxlID0gW10pIHsNCiAgICAgIGxldCByZXMgPSBbXQ0KICAgICAgZm9yIChjb25zdCByb3V0ZXIgb2Ygcm91dGVzKSB7DQogICAgICAgIC8vIHNraXAgaGlkZGVuIHJvdXRlcg0KICAgICAgICBpZiAocm91dGVyLmhpZGRlbikgeyBjb250aW51ZSB9DQogICAgICAgIGNvbnN0IGRhdGEgPSB7DQogICAgICAgICAgcGF0aDogcGF0aC5yZXNvbHZlKGJhc2VQYXRoLCByb3V0ZXIucGF0aCksDQogICAgICAgICAgdGl0bGU6IFsuLi5wcmVmaXhUaXRsZV0NCiAgICAgICAgfQ0KICAgICAgICBpZiAocm91dGVyLm1ldGEgJiYgcm91dGVyLm1ldGEudGl0bGUpIHsNCiAgICAgICAgICAvLyBnZW5lcmF0ZSBpbnRlcm5hdGlvbmFsaXplZCB0aXRsZQ0KICAgICAgICAgIGNvbnN0IGkxOG50aXRsZSA9IGkxOG4udChgcm91dGUuJHtyb3V0ZXIubWV0YS50aXRsZX1gKQ0KICAgICAgICAgIGRhdGEudGl0bGUgPSBbLi4uZGF0YS50aXRsZSwgaTE4bnRpdGxlXQ0KICAgICAgICAgIGlmIChyb3V0ZXIucmVkaXJlY3QgIT09ICdub1JlZGlyZWN0Jykgew0KICAgICAgICAgICAgLy8gb25seSBwdXNoIHRoZSByb3V0ZXMgd2l0aCB0aXRsZQ0KICAgICAgICAgICAgLy8gc3BlY2lhbCBjYXNlOiBuZWVkIHRvIGV4Y2x1ZGUgcGFyZW50IHJvdXRlciB3aXRob3V0IHJlZGlyZWN0DQogICAgICAgICAgICByZXMucHVzaChkYXRhKQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyByZWN1cnNpdmUgY2hpbGQgcm91dGVzDQogICAgICAgIGlmIChyb3V0ZXIuY2hpbGRyZW4pIHsNCiAgICAgICAgICBjb25zdCB0ZW1wUm91dGVzID0gdGhpcy5nZW5lcmF0ZVJvdXRlcyhyb3V0ZXIuY2hpbGRyZW4sIGRhdGEucGF0aCwgZGF0YS50aXRsZSkNCiAgICAgICAgICBpZiAodGVtcFJvdXRlcy5sZW5ndGggPj0gMSkgew0KICAgICAgICAgICAgcmVzID0gWy4uLnJlcywgLi4udGVtcFJvdXRlc10NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiByZXMNCiAgICB9LA0KICAgIHF1ZXJ5U2VhcmNoKHF1ZXJ5KSB7DQogICAgICBpZiAocXVlcnkgIT09ICcnKSB7DQogICAgICAgIHRoaXMub3B0aW9ucyA9IHRoaXMuZnVzZS5zZWFyY2gocXVlcnkpDQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLm9wdGlvbnMgPSBbXQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAoBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/HeaderSearch","sourcesContent":["<template>\r\n  <div :class=\"{'show':show}\" class=\"header-search\">\r\n    <svg-icon class-name=\"search-icon\" icon-class=\"search\" @click.stop=\"click\" />\r\n    <el-select\r\n      ref=\"headerSearchSelect\"\r\n      v-model=\"search\"\r\n      :remote-method=\"querySearch\"\r\n      filterable\r\n      default-first-option\r\n      remote\r\n      placeholder=\"Search\"\r\n      class=\"header-search-select\"\r\n      @change=\"change\"\r\n    >\r\n      <el-option v-for=\"item in options\" :key=\"item.path\" :value=\"item\" :label=\"item.title.join(' > ')\" />\r\n    </el-select>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// fuse is a lightweight fuzzy-search module\r\n// make search results more in line with expectations\r\nimport Fuse from 'fuse.js'\r\nimport path from 'path'\r\nimport i18n from '@/lang'\r\n\r\nexport default {\r\n  name: 'HeaderSearch',\r\n  data() {\r\n    return {\r\n      search: '',\r\n      options: [],\r\n      searchPool: [],\r\n      show: false,\r\n      fuse: undefined\r\n    }\r\n  },\r\n  computed: {\r\n    routes() {\r\n      return this.$store.getters.permission_routes\r\n    },\r\n    lang() {\r\n      return this.$store.getters.language\r\n    },\r\n    supportPinyinSearch() {\r\n      return this.$store.state.settings.supportPinyinSearch\r\n    }\r\n  },\r\n  watch: {\r\n    lang() {\r\n      this.searchPool = this.generateRoutes(this.routes)\r\n    },\r\n    routes() {\r\n      this.searchPool = this.generateRoutes(this.routes)\r\n    },\r\n    searchPool(list) {\r\n      // Support pinyin search\r\n      if (this.lang === 'zh' && this.supportPinyinSearch) {\r\n        this.addPinyinField(list)\r\n      }\r\n      this.initFuse(list)\r\n    },\r\n    show(value) {\r\n      if (value) {\r\n        document.body.addEventListener('click', this.close)\r\n      } else {\r\n        document.body.removeEventListener('click', this.close)\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.searchPool = this.generateRoutes(this.routes)\r\n  },\r\n  methods: {\r\n    async addPinyinField(list) {\r\n      const { default: pinyin } = await import('pinyin')\r\n      if (Array.isArray(list)) {\r\n        list.forEach(element => {\r\n          const title = element.title\r\n          if (Array.isArray(title)) {\r\n            title.forEach(v => {\r\n              v = pinyin(v, {\r\n                style: pinyin.STYLE_NORMAL\r\n              }).join('')\r\n              element.pinyinTitle = v\r\n            })\r\n          }\r\n        })\r\n        return list\r\n      }\r\n    },\r\n    click() {\r\n      this.show = !this.show\r\n      if (this.show) {\r\n        this.$refs.headerSearchSelect && this.$refs.headerSearchSelect.focus()\r\n      }\r\n    },\r\n    close() {\r\n      this.$refs.headerSearchSelect && this.$refs.headerSearchSelect.blur()\r\n      this.options = []\r\n      this.show = false\r\n    },\r\n    change(val) {\r\n      this.$router.push(val.path)\r\n      this.search = ''\r\n      this.options = []\r\n      this.$nextTick(() => {\r\n        this.show = false\r\n      })\r\n    },\r\n    initFuse(list) {\r\n      this.fuse = new Fuse(list, {\r\n        shouldSort: true,\r\n        threshold: 0.4,\r\n        location: 0,\r\n        distance: 100,\r\n        maxPatternLength: 32,\r\n        minMatchCharLength: 1,\r\n        keys: [{\r\n          name: 'title',\r\n          weight: 0.7\r\n        }, {\r\n          name: 'pinyinTitle',\r\n          weight: 0.3\r\n        }, {\r\n          name: 'path',\r\n          weight: 0.3\r\n        }]\r\n      })\r\n    },\r\n    // Filter out the routes that can be displayed in the sidebar\r\n    // And generate the internationalized title\r\n    generateRoutes(routes, basePath = '/', prefixTitle = []) {\r\n      let res = []\r\n      for (const router of routes) {\r\n        // skip hidden router\r\n        if (router.hidden) { continue }\r\n        const data = {\r\n          path: path.resolve(basePath, router.path),\r\n          title: [...prefixTitle]\r\n        }\r\n        if (router.meta && router.meta.title) {\r\n          // generate internationalized title\r\n          const i18ntitle = i18n.t(`route.${router.meta.title}`)\r\n          data.title = [...data.title, i18ntitle]\r\n          if (router.redirect !== 'noRedirect') {\r\n            // only push the routes with title\r\n            // special case: need to exclude parent router without redirect\r\n            res.push(data)\r\n          }\r\n        }\r\n        // recursive child routes\r\n        if (router.children) {\r\n          const tempRoutes = this.generateRoutes(router.children, data.path, data.title)\r\n          if (tempRoutes.length >= 1) {\r\n            res = [...res, ...tempRoutes]\r\n          }\r\n        }\r\n      }\r\n      return res\r\n    },\r\n    querySearch(query) {\r\n      if (query !== '') {\r\n        this.options = this.fuse.search(query)\r\n      } else {\r\n        this.options = []\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.header-search {\r\n  font-size: 0 !important;\r\n  .search-icon {\r\n    cursor: pointer;\r\n    font-size: 18px;\r\n    vertical-align: middle;\r\n  }\r\n  .header-search-select {\r\n    font-size: 18px;\r\n    transition: width 0.2s;\r\n    width: 0;\r\n    overflow: hidden;\r\n    background: transparent;\r\n    border-radius: 0;\r\n    display: inline-block;\r\n    vertical-align: middle;\r\n\r\n    ::v-deep .el-input__inner {\r\n      border-radius: 0;\r\n      border: 0;\r\n      padding-left: 0;\r\n      padding-right: 0;\r\n      box-shadow: none !important;\r\n      border-bottom: 1px solid #d9d9d9;\r\n      vertical-align: middle;\r\n    }\r\n  }\r\n  &.show {\r\n    .header-search-select {\r\n      width: 210px;\r\n      margin-left: 10px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}