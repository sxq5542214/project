{"remainingRequest":"H:\\workspaces\\vueProject\\lm\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!H:\\workspaces\\vueProject\\lm\\src\\views\\permission\\role.vue?vue&type=script&lang=js&","dependencies":[{"path":"H:\\workspaces\\vueProject\\lm\\src\\views\\permission\\role.vue","mtime":1686317623666},{"path":"H:\\workspaces\\vueProject\\lm\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686317881343},{"path":"H:\\workspaces\\vueProject\\lm\\node_modules\\babel-loader\\lib\\index.js","mtime":1686317882159},{"path":"H:\\workspaces\\vueProject\\lm\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686317881343},{"path":"H:\\workspaces\\vueProject\\lm\\node_modules\\vue-loader\\lib\\index.js","mtime":1686317877157}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgcGF0aCBmcm9tICdwYXRoJw0KaW1wb3J0IHsgZGVlcENsb25lIH0gZnJvbSAnQC91dGlscycNCmltcG9ydCB7IGdldFJvdXRlcywgZ2V0Um9sZXMsIGFkZFJvbGUsIGRlbGV0ZVJvbGUsIHVwZGF0ZVJvbGUgfSBmcm9tICdAL2FwaS9yb2xlJw0KaW1wb3J0IGkxOG4gZnJvbSAnQC9sYW5nJw0KDQpjb25zdCBkZWZhdWx0Um9sZSA9IHsNCiAga2V5OiAnJywNCiAgbmFtZTogJycsDQogIGRlc2NyaXB0aW9uOiAnJywNCiAgcm91dGVzOiBbXQ0KfQ0KDQpleHBvcnQgZGVmYXVsdCB7DQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHJvbGU6IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRSb2xlKSwNCiAgICAgIHJvdXRlczogW10sDQogICAgICByb2xlc0xpc3Q6IFtdLA0KICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UsDQogICAgICBkaWFsb2dUeXBlOiAnbmV3JywNCiAgICAgIGNoZWNrU3RyaWN0bHk6IGZhbHNlLA0KICAgICAgZGVmYXVsdFByb3BzOiB7DQogICAgICAgIGNoaWxkcmVuOiAnY2hpbGRyZW4nLA0KICAgICAgICBsYWJlbDogJ3RpdGxlJw0KICAgICAgfQ0KICAgIH0NCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICByb3V0ZXNEYXRhKCkgew0KICAgICAgcmV0dXJuIHRoaXMucm91dGVzDQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIC8vIE1vY2s6IGdldCBhbGwgcm91dGVzIGFuZCByb2xlcyBsaXN0IGZyb20gc2VydmVyDQogICAgdGhpcy5nZXRSb3V0ZXMoKQ0KICAgIHRoaXMuZ2V0Um9sZXMoKQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgYXN5bmMgZ2V0Um91dGVzKCkgew0KICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0Um91dGVzKCkNCiAgICAgIHRoaXMuc2VydmljZVJvdXRlcyA9IHJlcy5kYXRhDQogICAgICBjb25zdCByb3V0ZXMgPSB0aGlzLmdlbmVyYXRlUm91dGVzKHJlcy5kYXRhKQ0KICAgICAgdGhpcy5yb3V0ZXMgPSB0aGlzLmkxOG4ocm91dGVzKQ0KICAgIH0sDQogICAgYXN5bmMgZ2V0Um9sZXMoKSB7DQogICAgICBjb25zdCByZXMgPSBhd2FpdCBnZXRSb2xlcygpDQogICAgICB0aGlzLnJvbGVzTGlzdCA9IHJlcy5kYXRhDQogICAgfSwNCiAgICBpMThuKHJvdXRlcykgew0KICAgICAgY29uc3QgYXBwID0gcm91dGVzLm1hcChyb3V0ZSA9PiB7DQogICAgICAgIHJvdXRlLnRpdGxlID0gaTE4bi50KGByb3V0ZS4ke3JvdXRlLnRpdGxlfWApDQogICAgICAgIGlmIChyb3V0ZS5jaGlsZHJlbikgew0KICAgICAgICAgIHJvdXRlLmNoaWxkcmVuID0gdGhpcy5pMThuKHJvdXRlLmNoaWxkcmVuKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiByb3V0ZQ0KICAgICAgfSkNCiAgICAgIHJldHVybiBhcHANCiAgICB9LA0KICAgIC8vIFJlc2hhcGUgdGhlIHJvdXRlcyBzdHJ1Y3R1cmUgc28gdGhhdCBpdCBsb29rcyB0aGUgc2FtZSBhcyB0aGUgc2lkZWJhcg0KICAgIGdlbmVyYXRlUm91dGVzKHJvdXRlcywgYmFzZVBhdGggPSAnLycpIHsNCiAgICAgIGNvbnN0IHJlcyA9IFtdDQoNCiAgICAgIGZvciAobGV0IHJvdXRlIG9mIHJvdXRlcykgew0KICAgICAgICAvLyBza2lwIHNvbWUgcm91dGUNCiAgICAgICAgaWYgKHJvdXRlLmhpZGRlbikgeyBjb250aW51ZSB9DQoNCiAgICAgICAgY29uc3Qgb25seU9uZVNob3dpbmdDaGlsZCA9IHRoaXMub25seU9uZVNob3dpbmdDaGlsZChyb3V0ZS5jaGlsZHJlbiwgcm91dGUpDQoNCiAgICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuICYmIG9ubHlPbmVTaG93aW5nQ2hpbGQgJiYgIXJvdXRlLmFsd2F5c1Nob3cpIHsNCiAgICAgICAgICByb3V0ZSA9IG9ubHlPbmVTaG93aW5nQ2hpbGQNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnN0IGRhdGEgPSB7DQogICAgICAgICAgcGF0aDogcGF0aC5yZXNvbHZlKGJhc2VQYXRoLCByb3V0ZS5wYXRoKSwNCiAgICAgICAgICB0aXRsZTogcm91dGUubWV0YSAmJiByb3V0ZS5tZXRhLnRpdGxlDQoNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHJlY3Vyc2l2ZSBjaGlsZCByb3V0ZXMNCiAgICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuKSB7DQogICAgICAgICAgZGF0YS5jaGlsZHJlbiA9IHRoaXMuZ2VuZXJhdGVSb3V0ZXMocm91dGUuY2hpbGRyZW4sIGRhdGEucGF0aCkNCiAgICAgICAgfQ0KICAgICAgICByZXMucHVzaChkYXRhKQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlcw0KICAgIH0sDQogICAgZ2VuZXJhdGVBcnIocm91dGVzKSB7DQogICAgICBsZXQgZGF0YSA9IFtdDQogICAgICByb3V0ZXMuZm9yRWFjaChyb3V0ZSA9PiB7DQogICAgICAgIGRhdGEucHVzaChyb3V0ZSkNCiAgICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuKSB7DQogICAgICAgICAgY29uc3QgdGVtcCA9IHRoaXMuZ2VuZXJhdGVBcnIocm91dGUuY2hpbGRyZW4pDQogICAgICAgICAgaWYgKHRlbXAubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgZGF0YSA9IFsuLi5kYXRhLCAuLi50ZW1wXQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICAgIHJldHVybiBkYXRhDQogICAgfSwNCiAgICBoYW5kbGVBZGRSb2xlKCkgew0KICAgICAgdGhpcy5yb2xlID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdFJvbGUpDQogICAgICBpZiAodGhpcy4kcmVmcy50cmVlKSB7DQogICAgICAgIHRoaXMuJHJlZnMudHJlZS5zZXRDaGVja2VkTm9kZXMoW10pDQogICAgICB9DQogICAgICB0aGlzLmRpYWxvZ1R5cGUgPSAnbmV3Jw0KICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZQ0KICAgIH0sDQogICAgaGFuZGxlRWRpdChzY29wZSkgew0KICAgICAgdGhpcy5kaWFsb2dUeXBlID0gJ2VkaXQnDQogICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSB0cnVlDQogICAgICB0aGlzLmNoZWNrU3RyaWN0bHkgPSB0cnVlDQogICAgICB0aGlzLnJvbGUgPSBkZWVwQ2xvbmUoc2NvcGUucm93KQ0KICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICBjb25zdCByb3V0ZXMgPSB0aGlzLmdlbmVyYXRlUm91dGVzKHRoaXMucm9sZS5yb3V0ZXMpDQogICAgICAgIHRoaXMuJHJlZnMudHJlZS5zZXRDaGVja2VkTm9kZXModGhpcy5nZW5lcmF0ZUFycihyb3V0ZXMpKQ0KICAgICAgICAvLyBzZXQgY2hlY2tlZCBzdGF0ZSBvZiBhIG5vZGUgbm90IGFmZmVjdHMgaXRzIGZhdGhlciBhbmQgY2hpbGQgbm9kZXMNCiAgICAgICAgdGhpcy5jaGVja1N0cmljdGx5ID0gZmFsc2UNCiAgICAgIH0pDQogICAgfSwNCiAgICBoYW5kbGVEZWxldGUoeyAkaW5kZXgsIHJvdyB9KSB7DQogICAgICB0aGlzLiRjb25maXJtKCdDb25maXJtIHRvIHJlbW92ZSB0aGUgcm9sZT8nLCAnV2FybmluZycsIHsNCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICdDb25maXJtJywNCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ0NhbmNlbCcsDQogICAgICAgIHR5cGU6ICd3YXJuaW5nJw0KICAgICAgfSkNCiAgICAgICAgLnRoZW4oYXN5bmMoKSA9PiB7DQogICAgICAgICAgYXdhaXQgZGVsZXRlUm9sZShyb3cua2V5KQ0KICAgICAgICAgIHRoaXMucm9sZXNMaXN0LnNwbGljZSgkaW5kZXgsIDEpDQogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7DQogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsDQogICAgICAgICAgICBtZXNzYWdlOiAnRGVsZXRlIHN1Y2NlZCEnDQogICAgICAgICAgfSkNCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKGVyciA9PiB7IGNvbnNvbGUuZXJyb3IoZXJyKSB9KQ0KICAgIH0sDQogICAgZ2VuZXJhdGVUcmVlKHJvdXRlcywgYmFzZVBhdGggPSAnLycsIGNoZWNrZWRLZXlzKSB7DQogICAgICBjb25zdCByZXMgPSBbXQ0KDQogICAgICBmb3IgKGNvbnN0IHJvdXRlIG9mIHJvdXRlcykgew0KICAgICAgICBjb25zdCByb3V0ZVBhdGggPSBwYXRoLnJlc29sdmUoYmFzZVBhdGgsIHJvdXRlLnBhdGgpDQoNCiAgICAgICAgLy8gcmVjdXJzaXZlIGNoaWxkIHJvdXRlcw0KICAgICAgICBpZiAocm91dGUuY2hpbGRyZW4pIHsNCiAgICAgICAgICByb3V0ZS5jaGlsZHJlbiA9IHRoaXMuZ2VuZXJhdGVUcmVlKHJvdXRlLmNoaWxkcmVuLCByb3V0ZVBhdGgsIGNoZWNrZWRLZXlzKQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGNoZWNrZWRLZXlzLmluY2x1ZGVzKHJvdXRlUGF0aCkgfHwgKHJvdXRlLmNoaWxkcmVuICYmIHJvdXRlLmNoaWxkcmVuLmxlbmd0aCA+PSAxKSkgew0KICAgICAgICAgIHJlcy5wdXNoKHJvdXRlKQ0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gcmVzDQogICAgfSwNCiAgICBhc3luYyBjb25maXJtUm9sZSgpIHsNCiAgICAgIGNvbnN0IGlzRWRpdCA9IHRoaXMuZGlhbG9nVHlwZSA9PT0gJ2VkaXQnDQoNCiAgICAgIGNvbnN0IGNoZWNrZWRLZXlzID0gdGhpcy4kcmVmcy50cmVlLmdldENoZWNrZWRLZXlzKCkNCiAgICAgIHRoaXMucm9sZS5yb3V0ZXMgPSB0aGlzLmdlbmVyYXRlVHJlZShkZWVwQ2xvbmUodGhpcy5zZXJ2aWNlUm91dGVzKSwgJy8nLCBjaGVja2VkS2V5cykNCg0KICAgICAgaWYgKGlzRWRpdCkgew0KICAgICAgICBhd2FpdCB1cGRhdGVSb2xlKHRoaXMucm9sZS5rZXksIHRoaXMucm9sZSkNCiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMucm9sZXNMaXN0Lmxlbmd0aDsgaW5kZXgrKykgew0KICAgICAgICAgIGlmICh0aGlzLnJvbGVzTGlzdFtpbmRleF0ua2V5ID09PSB0aGlzLnJvbGUua2V5KSB7DQogICAgICAgICAgICB0aGlzLnJvbGVzTGlzdC5zcGxpY2UoaW5kZXgsIDEsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMucm9sZSkpDQogICAgICAgICAgICBicmVhaw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBhZGRSb2xlKHRoaXMucm9sZSkNCiAgICAgICAgdGhpcy5yb2xlLmtleSA9IGRhdGEua2V5DQogICAgICAgIHRoaXMucm9sZXNMaXN0LnB1c2godGhpcy5yb2xlKQ0KICAgICAgfQ0KDQogICAgICBjb25zdCB7IGRlc2NyaXB0aW9uLCBrZXksIG5hbWUgfSA9IHRoaXMucm9sZQ0KICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2UNCiAgICAgIHRoaXMuJG5vdGlmeSh7DQogICAgICAgIHRpdGxlOiAnU3VjY2VzcycsDQogICAgICAgIGRhbmdlcm91c2x5VXNlSFRNTFN0cmluZzogdHJ1ZSwNCiAgICAgICAgbWVzc2FnZTogYA0KICAgICAgICAgICAgPGRpdj5Sb2xlIEtleTogJHtrZXl9PC9kaXY+DQogICAgICAgICAgICA8ZGl2PlJvbGUgTmFtZTogJHtuYW1lfTwvZGl2Pg0KICAgICAgICAgICAgPGRpdj5EZXNjcmlwdGlvbjogJHtkZXNjcmlwdGlvbn08L2Rpdj4NCiAgICAgICAgICBgLA0KICAgICAgICB0eXBlOiAnc3VjY2VzcycNCiAgICAgIH0pDQogICAgfSwNCiAgICAvLyByZWZlcmVuY2U6IHNyYy92aWV3L2xheW91dC9jb21wb25lbnRzL1NpZGViYXIvU2lkZWJhckl0ZW0udnVlDQogICAgb25seU9uZVNob3dpbmdDaGlsZChjaGlsZHJlbiA9IFtdLCBwYXJlbnQpIHsNCiAgICAgIGxldCBvbmx5T25lQ2hpbGQgPSBudWxsDQogICAgICBjb25zdCBzaG93aW5nQ2hpbGRyZW4gPSBjaGlsZHJlbi5maWx0ZXIoaXRlbSA9PiAhaXRlbS5oaWRkZW4pDQoNCiAgICAgIC8vIFdoZW4gdGhlcmUgaXMgb25seSBvbmUgY2hpbGQgcm91dGUsIHRoZSBjaGlsZCByb3V0ZSBpcyBkaXNwbGF5ZWQgYnkgZGVmYXVsdA0KICAgICAgaWYgKHNob3dpbmdDaGlsZHJlbi5sZW5ndGggPT09IDEpIHsNCiAgICAgICAgb25seU9uZUNoaWxkID0gc2hvd2luZ0NoaWxkcmVuWzBdDQogICAgICAgIG9ubHlPbmVDaGlsZC5wYXRoID0gcGF0aC5yZXNvbHZlKHBhcmVudC5wYXRoLCBvbmx5T25lQ2hpbGQucGF0aCkNCiAgICAgICAgcmV0dXJuIG9ubHlPbmVDaGlsZA0KICAgICAgfQ0KDQogICAgICAvLyBTaG93IHBhcmVudCBpZiB0aGVyZSBhcmUgbm8gY2hpbGQgcm91dGUgdG8gZGlzcGxheQ0KICAgICAgaWYgKHNob3dpbmdDaGlsZHJlbi5sZW5ndGggPT09IDApIHsNCiAgICAgICAgb25seU9uZUNoaWxkID0geyAuLi4gcGFyZW50LCBwYXRoOiAnJywgbm9TaG93aW5nQ2hpbGRyZW46IHRydWUgfQ0KICAgICAgICByZXR1cm4gb25seU9uZUNoaWxkDQogICAgICB9DQoNCiAgICAgIHJldHVybiBmYWxzZQ0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["role.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"role.vue","sourceRoot":"src/views/permission","sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <el-button type=\"primary\" @click=\"handleAddRole\">\r\n      {{ $t('permission.addRole') }}\r\n    </el-button>\r\n\r\n    <el-table :data=\"rolesList\" style=\"width: 100%;margin-top:30px;\" border>\r\n      <el-table-column align=\"center\" label=\"Role Key\" width=\"220\">\r\n        <template slot-scope=\"scope\">\r\n          {{ scope.row.key }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column align=\"center\" label=\"Role Name\" width=\"220\">\r\n        <template slot-scope=\"scope\">\r\n          {{ scope.row.name }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column align=\"header-center\" label=\"Description\">\r\n        <template slot-scope=\"scope\">\r\n          {{ scope.row.description }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column align=\"center\" label=\"Operations\">\r\n        <template slot-scope=\"scope\">\r\n          <el-button type=\"primary\" size=\"small\" @click=\"handleEdit(scope)\">\r\n            {{ $t('permission.editPermission') }}\r\n          </el-button>\r\n          <el-button type=\"danger\" size=\"small\" @click=\"handleDelete(scope)\">\r\n            {{ $t('permission.delete') }}\r\n          </el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <el-dialog :visible.sync=\"dialogVisible\" :title=\"dialogType==='edit'?'Edit Role':'New Role'\">\r\n      <el-form :model=\"role\" label-width=\"80px\" label-position=\"left\">\r\n        <el-form-item label=\"Name\">\r\n          <el-input v-model=\"role.name\" placeholder=\"Role Name\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"Desc\">\r\n          <el-input\r\n            v-model=\"role.description\"\r\n            :autosize=\"{ minRows: 2, maxRows: 4}\"\r\n            type=\"textarea\"\r\n            placeholder=\"Role Description\"\r\n          />\r\n        </el-form-item>\r\n        <el-form-item label=\"Menus\">\r\n          <el-tree ref=\"tree\" :check-strictly=\"checkStrictly\" :data=\"routesData\" :props=\"defaultProps\" show-checkbox node-key=\"path\" class=\"permission-tree\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      <div style=\"text-align:right;\">\r\n        <el-button type=\"danger\" @click=\"dialogVisible=false\">\r\n          {{ $t('permission.cancel') }}\r\n        </el-button>\r\n        <el-button type=\"primary\" @click=\"confirmRole\">\r\n          {{ $t('permission.confirm') }}\r\n        </el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport path from 'path'\r\nimport { deepClone } from '@/utils'\r\nimport { getRoutes, getRoles, addRole, deleteRole, updateRole } from '@/api/role'\r\nimport i18n from '@/lang'\r\n\r\nconst defaultRole = {\r\n  key: '',\r\n  name: '',\r\n  description: '',\r\n  routes: []\r\n}\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      role: Object.assign({}, defaultRole),\r\n      routes: [],\r\n      rolesList: [],\r\n      dialogVisible: false,\r\n      dialogType: 'new',\r\n      checkStrictly: false,\r\n      defaultProps: {\r\n        children: 'children',\r\n        label: 'title'\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    routesData() {\r\n      return this.routes\r\n    }\r\n  },\r\n  created() {\r\n    // Mock: get all routes and roles list from server\r\n    this.getRoutes()\r\n    this.getRoles()\r\n  },\r\n  methods: {\r\n    async getRoutes() {\r\n      const res = await getRoutes()\r\n      this.serviceRoutes = res.data\r\n      const routes = this.generateRoutes(res.data)\r\n      this.routes = this.i18n(routes)\r\n    },\r\n    async getRoles() {\r\n      const res = await getRoles()\r\n      this.rolesList = res.data\r\n    },\r\n    i18n(routes) {\r\n      const app = routes.map(route => {\r\n        route.title = i18n.t(`route.${route.title}`)\r\n        if (route.children) {\r\n          route.children = this.i18n(route.children)\r\n        }\r\n        return route\r\n      })\r\n      return app\r\n    },\r\n    // Reshape the routes structure so that it looks the same as the sidebar\r\n    generateRoutes(routes, basePath = '/') {\r\n      const res = []\r\n\r\n      for (let route of routes) {\r\n        // skip some route\r\n        if (route.hidden) { continue }\r\n\r\n        const onlyOneShowingChild = this.onlyOneShowingChild(route.children, route)\r\n\r\n        if (route.children && onlyOneShowingChild && !route.alwaysShow) {\r\n          route = onlyOneShowingChild\r\n        }\r\n\r\n        const data = {\r\n          path: path.resolve(basePath, route.path),\r\n          title: route.meta && route.meta.title\r\n\r\n        }\r\n\r\n        // recursive child routes\r\n        if (route.children) {\r\n          data.children = this.generateRoutes(route.children, data.path)\r\n        }\r\n        res.push(data)\r\n      }\r\n      return res\r\n    },\r\n    generateArr(routes) {\r\n      let data = []\r\n      routes.forEach(route => {\r\n        data.push(route)\r\n        if (route.children) {\r\n          const temp = this.generateArr(route.children)\r\n          if (temp.length > 0) {\r\n            data = [...data, ...temp]\r\n          }\r\n        }\r\n      })\r\n      return data\r\n    },\r\n    handleAddRole() {\r\n      this.role = Object.assign({}, defaultRole)\r\n      if (this.$refs.tree) {\r\n        this.$refs.tree.setCheckedNodes([])\r\n      }\r\n      this.dialogType = 'new'\r\n      this.dialogVisible = true\r\n    },\r\n    handleEdit(scope) {\r\n      this.dialogType = 'edit'\r\n      this.dialogVisible = true\r\n      this.checkStrictly = true\r\n      this.role = deepClone(scope.row)\r\n      this.$nextTick(() => {\r\n        const routes = this.generateRoutes(this.role.routes)\r\n        this.$refs.tree.setCheckedNodes(this.generateArr(routes))\r\n        // set checked state of a node not affects its father and child nodes\r\n        this.checkStrictly = false\r\n      })\r\n    },\r\n    handleDelete({ $index, row }) {\r\n      this.$confirm('Confirm to remove the role?', 'Warning', {\r\n        confirmButtonText: 'Confirm',\r\n        cancelButtonText: 'Cancel',\r\n        type: 'warning'\r\n      })\r\n        .then(async() => {\r\n          await deleteRole(row.key)\r\n          this.rolesList.splice($index, 1)\r\n          this.$message({\r\n            type: 'success',\r\n            message: 'Delete succed!'\r\n          })\r\n        })\r\n        .catch(err => { console.error(err) })\r\n    },\r\n    generateTree(routes, basePath = '/', checkedKeys) {\r\n      const res = []\r\n\r\n      for (const route of routes) {\r\n        const routePath = path.resolve(basePath, route.path)\r\n\r\n        // recursive child routes\r\n        if (route.children) {\r\n          route.children = this.generateTree(route.children, routePath, checkedKeys)\r\n        }\r\n\r\n        if (checkedKeys.includes(routePath) || (route.children && route.children.length >= 1)) {\r\n          res.push(route)\r\n        }\r\n      }\r\n      return res\r\n    },\r\n    async confirmRole() {\r\n      const isEdit = this.dialogType === 'edit'\r\n\r\n      const checkedKeys = this.$refs.tree.getCheckedKeys()\r\n      this.role.routes = this.generateTree(deepClone(this.serviceRoutes), '/', checkedKeys)\r\n\r\n      if (isEdit) {\r\n        await updateRole(this.role.key, this.role)\r\n        for (let index = 0; index < this.rolesList.length; index++) {\r\n          if (this.rolesList[index].key === this.role.key) {\r\n            this.rolesList.splice(index, 1, Object.assign({}, this.role))\r\n            break\r\n          }\r\n        }\r\n      } else {\r\n        const { data } = await addRole(this.role)\r\n        this.role.key = data.key\r\n        this.rolesList.push(this.role)\r\n      }\r\n\r\n      const { description, key, name } = this.role\r\n      this.dialogVisible = false\r\n      this.$notify({\r\n        title: 'Success',\r\n        dangerouslyUseHTMLString: true,\r\n        message: `\r\n            <div>Role Key: ${key}</div>\r\n            <div>Role Name: ${name}</div>\r\n            <div>Description: ${description}</div>\r\n          `,\r\n        type: 'success'\r\n      })\r\n    },\r\n    // reference: src/view/layout/components/Sidebar/SidebarItem.vue\r\n    onlyOneShowingChild(children = [], parent) {\r\n      let onlyOneChild = null\r\n      const showingChildren = children.filter(item => !item.hidden)\r\n\r\n      // When there is only one child route, the child route is displayed by default\r\n      if (showingChildren.length === 1) {\r\n        onlyOneChild = showingChildren[0]\r\n        onlyOneChild.path = path.resolve(parent.path, onlyOneChild.path)\r\n        return onlyOneChild\r\n      }\r\n\r\n      // Show parent if there are no child route to display\r\n      if (showingChildren.length === 0) {\r\n        onlyOneChild = { ... parent, path: '', noShowingChildren: true }\r\n        return onlyOneChild\r\n      }\r\n\r\n      return false\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.app-container {\r\n  .roles-table {\r\n    margin-top: 30px;\r\n  }\r\n  .permission-tree {\r\n    margin-bottom: 30px;\r\n  }\r\n}\r\n</style>\r\n"]}]}